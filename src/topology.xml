<?xml version="1.0"?>
<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:id="topology">
	<title>Topology</title>
	<info>
	</info>
	<para>
		The definition of the topology by the user has to be simple and powerful at the same time. The simple and powerful so called topology language has been developed. The basic building block of the system is a task. Namely, a task is a user defined executable or a shell script, which will be deployed and executed by DDS on a Resource Management System. To describe dependencies between tasks in a topology we use properties. For example, if one task wants to communicate with another task they can have the same property of a type TCP/IP port. In this case DDS will notice that and set this number to configuration files of both user processes. Moreover, there will be different types of properties, for example, tasks can be dependent on each other via a file or a named pipe.
	</para>
	<para>
	Tasks can be grouped into DDS collections and DDS groups. The difference between collections and groups is that collections are a signal to DDS topology parser that tasks of given collections will be executed on the same physical machine. This is useful if tasks have a lot of communication or they want to access the same shared memory. A set of tasks and task collections can be also grouped into task groups. Only group define multiplication factor for all its daughter elements.
	</para>
	<para>
		Main group defines the entry point for task execution. Only main group can contain other groups.
    </para>
	<para>
		For the moment topology is described in the XML file. XML is chosen because it can be validated against XSD schema. XSD schema file can be found in <filename>dds-install-dir/share/topology.xsd</filename>. 
	</para>
	<sect1 xml:id="topology-section1">
		<title>General description of XML file</title>
		<screen><![CDATA[
<topology id="myTopology">
   [... Definition of tasks, properties, and collections ...]
   <main name="main">
      [... Definition of the topology itself, where also groups can be defined ...]
   </main>
</topology>]]></screen>
    <para>
		In the upper part of the XML file properties, tasks and collections which are later used in the main block are defined. In the main block topology itself is defined. Groups and multiplication factors are also defined in main block.
	</para>
	</sect1>
	<sect1 xml:id="topology-section2">
		<title>XML file example</title>
		<screen><![CDATA[
<topology id="myTopology">
	
   <property id="property1" />
   <property id="property2" />

   <decltask id="task1">
      <exe reachable="true">app1 -l -n</exe>
      <env reachable="false">env1</env>
      <properties>
         <id>property1</id>
         <id>property2</id>
      </properties>
   </decltask>
   <decltask id="task2">
      <exe>app2</exe>
      <properties>
         <id>property1</id>
      </properties>
   </decltask>

   <declcollection id="collection1">
      <task>task1</task>
      <task>task2</task>
      <task>task2</task>
   </declcollection>
   
   <declcollection id="collection2">
      <task>task1</task>
      <task>task1</task>
   </declcollection>
	
   <main id="main">
      <task>task1</task>
      <collection>collection1</collection>
      <group id="group1" n="10">
         <task>task1</task>
         <collection>collection1</collection>
         <collection>collection2</collection>
      </group>
      <group id="group2" n="15">
         <collection>collection1</collection>
      </group>
   </main>
	
</topology>
]]></screen>
    <para>
		In the example above we define 2 properties - <emphasis>property1</emphasis> and <emphasis>property2</emphasis>. As you can see <tag>property</tag> tag is used to define properties. <emphasis>id</emphasis> attribute is required and has to be unique for all properties. 
	</para>
	<para>
		In the next block we define tasks. For this <tag>decltask</tag> tag is used. As properties tasks also have <tag>id</tag> attribute which is required and has to be unique for all declared tasks. <tag>exe</tag> element defines path to executable. It has optional attribute <tag>reachable</tag> which defines if executable is available on the worker node. If any script that sets environment has to be executed prior to main executable one can specify it using <tag>env</tag> element. <tag>env</tag> also have <tag>reachable</tag> attribute which defines if script is available on the worker node or not. If task depends on the properties this can de specified using <tag>properties</tag> tag together with a list of <tag>id</tag> elements which specified id of already declared properties. Property must be declared before it can be used in the task. 
	</para>
	<para>
		Collections are declared using <tag>declcollection</tag> tag. It containes a list of <tag>task</tag> tags with IDs which specified already declared tasks. Task has to be declared before it can be used in the collection.
	</para>
	<para>
		The <tag>main</tag> tag declares the topology itself. In the example our main block consists of one task (<emphasis>task1</emphasis>), one collection (<emphasis>collection1</emphasis>) and two groups (<emphasis>group1</emphasis> and <emphasis>group2</emphasis>). In the main block two groups are declared. Group is declared using <tag>group</tag> tag. It has a required attribute <tag>id</tag> which is used to uniquely identify the group and optional attribute <tag>n</tag> which defines multiplication factor for the group. In the example <emphasis>group1</emphasis> consists of one task (<emphasis>task1</emphasis>) and two collections (<emphasis>collection1</emphasis> and <emphasis>collection2</emphasis>). <emphasis>group2</emphasis> consists of one collection (<emphasis>collection1</emphasis>).
	</para>
	</sect1>
	<sect1 xml:id="topology-section3">
		<title>Topology XML tag reference</title>
		
		<table>
		   	<title>Topology XML tags</title>
		   	<tgroup cols='2' align='left' colsep='1' rowsep='1'>
		    	<colspec colname='tag' colwidth='70pt'/>
		      	<colspec colname='description'/>
		     	<thead>
		  			<row>
		      		  <entry>Tag</entry>
		  			  <entry>Description</entry>
				  	</row>
				</thead>
				<tbody>
					<row>
						<entry><tag>topology</tag>
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para>No
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para><tag>property</tag>, <tag>task</tag>, <tag>collection</tag>, <tag>main</tag>
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para><tag>id</tag>
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Declares a topology.
						    </para>
							<para>
<screen><![CDATA[
<topology id="myTopology">
  [... Definition of tasks, 
       properties, collections and 
	   groups ...]
</topology>]]>
</screen>
                            </para>
					    </entry>
					</row>
					<row>
						<entry><tag>property</tag>
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>topology</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para><tag>id</tag>
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Declares a property.
						    </para>
							<para>
<screen><![CDATA[
<property id="property1"/>
<property id="property2"/>]]>
</screen>
                            </para>
					    </entry>
					</row>
					<row>
						<entry><tag>decltask</tag>
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>topology</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para><tag>properties</tag>
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para><tag>id</tag>
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Declares a task.
						    </para>
							<para>
<screen><![CDATA[
<decltask id="task1">
    <exe reachable="true">app1 -l -n</exe>
    <env reachable="false">env1</env>
    <properties>
        <id>property1</id>
        <id>property2</id>
    </properties>
</decltask>]]>
</screen>
</para>
						</entry>
					</row>
					<row>
						<entry><tag>declcollection</tag>
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>topology</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para><tag>task</tag>
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para><tag>id</tag>
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Declares a collection.
						    </para>
							<para>
<screen><![CDATA[
<declcollection id="collection1">
    <task>task1</task>
    <task>task1</task>
</declcollection>]]>
</screen>
</para>
						</entry>
				    </row>
					<row>
						<entry><tag>task</tag>
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>collection</tag>, <tag>group</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Specifies the unique ID of the already defined task.
						    </para>
							<para>
<screen><![CDATA[
<task>task1</task>]]>
</screen>
</para>
						</entry>
				    </row>
					<row>
						<entry><tag>collection</tag>
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>group</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Specifies the unique ID of the already defined collection.
						    </para>
							<para>
<screen><![CDATA[
<collection>collection1</collection>]]>
</screen>
</para>
						</entry>
				    </row>
					<row>
						<entry><tag>group</tag>
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>main</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para><tag>task</tag>, <tag>collection</tag>
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para><tag>id</tag>, <tag>n</tag>
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Declares a group.
						    </para>
							<para>
<screen><![CDATA[
<group id="group1" n="10">
    <task>task1</task>
    <collection>collection1</collection>
    <collection>collection2</collection>
</group>]]>
</screen>
</para>
						</entry>
					</row>
					<row>
						<entry><tag>main</tag>
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>topology</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para><tag>task</tag>, <tag>collection</tag>, <tag>group</tag>
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para><tag>id</tag>, <tag>n</tag>
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Declares a main group.
						    </para>
							<para>
<screen><![CDATA[
<main id="main">
    <task>task1</task>
    <collection>collection1</collection>
    <group id="group1" n="10">
        <task>task1</task>
        <collection>collection1</collection>
        <collection>collection2</collection>
    </group>
</main>]]>
</screen>
</para>
						</entry>
					</row>
					<row>
						<entry><tag>exe</tag> (required)
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>decltask</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para><tag>reachable</tag>
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Defines path to the executable or script for the task.
						    </para>
							<para>
<screen><![CDATA[
<exe reachable="true">app1 -l -n</exe>]]>
</screen>
</para>
						</entry>
				    </row>
					<row>
						<entry><tag>env</tag> (optional)
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>decltask</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para><tag>reachable</tag>
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Defines the path to script that has to be executed prior to main executable.
						    </para>
							<para>
<screen><![CDATA[
<env reachable="false">setEnv.sh</env>]]>
</screen>
</para>
						</entry>
				    </row>
					<row>
						<entry><tag>properties</tag> (optional)
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>decltask</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para><tag>id</tag>
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Defines a list of dependent properties.
						    </para>
							<para>
<screen><![CDATA[
<properties>
    <id>property1</id>
    <id>property2</id>
</properties>]]>
</screen>
</para>
						</entry>
				    </row>
					<row>
						<entry><tag>id</tag> (required)
					    </entry>
						<entry>
							<para><emphasis>Parents</emphasis> 
						    </para>
							<para><tag>properties</tag>
							</para>
						    <para><emphasis>Children</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Attributes</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Defines an ID of the already declared property.
						    </para>
							<para>
<screen><![CDATA[
<id>property1</id>]]>
</screen>
</para>
						</entry>
				    </row>
			   </tbody>
			</tgroup>
		</table>
		
		
		<table>
			<title>Topology XML attributes</title>
			<tgroup cols='2' align='left' colsep='1' rowsep='1'>
			    <colspec colname='attribute' colwidth='70pt'/>
			    <colspec colname='description'/>
				<thead>
					<row><entry>Attribute</entry><entry>Description</entry></row>
				</thead>
				<tbody>
					<row>
						<entry><tag>id</tag>
					    </entry>
						<entry>
							<para><emphasis>Use</emphasis> 
						    </para>
							<para>required
							</para>
						    <para><emphasis>Default</emphasis>
						    </para>
							<para>No
						    </para>
							<para><emphasis>Tags</emphasis>
						    </para>
							<para><tag>topology</tag>, <tag>property</tag>, <tag>decltask</tag>, <tag>declcollection</tag>, <tag>group</tag>, <tag>main</tag>
						    </para>
							<para><emphasis>Restrictions</emphasis> 
						    </para>
							<para>String with minimum length of 1 character.
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Defines identificator (ID) for topology, propertiy, task, collection and group. ID has to be unique within its scope, i.e. ID for tasks has to be unique only for tasks.
						    </para>
							<para>
<screen><![CDATA[
<topology id="myTopology">]]>
</screen>
							</para>
					    </entry>
					</row>
					<row>
						<entry><tag>reachable</tag>
					    </entry>
						<entry>
							<para><emphasis>Use</emphasis> 
						    </para>
							<para>optional
							</para>
						    <para><emphasis>Default</emphasis>
						    </para>
							<para>true
						    </para>
							<para><emphasis>Tags</emphasis>
						    </para>
							<para><tag>exe</tag>, <tag>env</tag>
						    </para>
							<para><emphasis>Restrictions</emphasis> 
						    </para>
							<para>true|false
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Defines if executable or script is available on the worker node.
						    </para>
							<para>
<screen><![CDATA[
<exe reachable="true">app -l</exe>
<env>env1</env>]]>
</screen>
							</para>
					    </entry>
					</row>
					<row>
						<entry><tag>n</tag>
					    </entry>
						<entry>
							<para><emphasis>Use</emphasis> 
						    </para>
							<para>optional
							</para>
						    <para><emphasis>Default</emphasis>
						    </para>
							<para>1
						    </para>
							<para><emphasis>Tags</emphasis>
						    </para>
							<para><tag>group</tag>
						    </para>
							<para><emphasis>Restrictions</emphasis> 
						    </para>
							<para>unsigned integer 32-bit which is more or equal to 1
						    </para>
							<para><emphasis>Description</emphasis> 
						    </para>
							<para>Defines multiplication factor for group.
						    </para>
							<para>
<screen><![CDATA[
<exe reachable="true">app -l</exe>
<env>env1</env>]]>
</screen>
							</para>
					    </entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</sect1>
</chapter>
